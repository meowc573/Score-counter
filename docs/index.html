<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ตัวนับคะแนน</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      padding: 20px;
      max-width: 400px;
      margin: auto;
      background: #f0f2f5;
      color: #333;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #4a90e2;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #f5a623;
    }
    .output {
      background: #fff;
      padding: 16px;
      margin-top: 24px;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>

  <h1>ตัวนับคะแนน</h1>

  <label>คะแนน (Points)</label>
  <input type="number" id="points" value="100" min="0" />

  <label>ทุกๆ (จำนวน) หน่วยเวลา</label>
  <div style="display:flex; gap:10px;">
    <input type="number" id="timeAmount" value="10" min="1" style="flex:1" />
    <select id="timeUnit" style="flex:1">
      <option value="seconds">วินาที</option>
      <option value="minutes" selected>นาที</option>
      <option value="hours">ชั่วโมง</option>
      <option value="days">วัน</option>
    </select>
  </div>

  <label>คะแนนเป้าหมาย (ถ้ามี)</label>
  <input type="number" id="targetScore" placeholder="ใส่คะแนนเป้าหมาย (ถ้ามี)" />

  <div style="display:flex; gap:10px;">
    <button onclick="start()">เริ่ม</button>
    <button onclick="pause()">พัก</button>
    <button onclick="reset()">รีเซต</button>
  </div>

  <div class="output">
    <p>สถานะ: <span id="status">รอเริ่ม...</span></p>
    <p>คะแนน: <span id="score">0</span></p>
    <p>เวลาที่ใช้ทั้งหมด: <span id="elapsed">-</span></p>
    <p>เวลาที่ผ่านไป: <span id="timePassed">-</span></p>
    <p>เวลาที่เหลือ: <span id="timeRemaining">-</span></p>
  </div>

<script>
  function formatTime(ms) {
    if (ms < 0) ms = 0;
    const sec = Math.floor(ms / 1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = sec % 60;
    return `${days} วัน ${hours} ชม. ${minutes} นาที ${seconds} วิ`;
  }

  function formatScore(score) {
    return Number.isInteger(score) ? score.toString() : score.toFixed(2);
  }

  function calculateRate() {
    const points = parseFloat(document.getElementById("points").value) || 0;
    const timeAmount = parseFloat(document.getElementById("timeAmount").value) || 1;
    const unit = document.getElementById("timeUnit").value;

    let seconds = timeAmount;
    if (unit === "minutes") seconds *= 60;
    else if (unit === "hours") seconds *= 3600;
    else if (unit === "days") seconds *= 86400;

    return points / seconds;
  }

  let score = 0;
  let startTime = null;
  let pausedTime = 0;
  let pauseStart = null;
  let interval = null;
  let ratePerSecond = 0;
  let isRunning = false;

  function update() {
    if (!isRunning) return;

    const now = new Date();
    let elapsedMs = now - startTime - pausedTime;
    if (elapsedMs < 0) elapsedMs = 0;

    const unit = document.getElementById("timeUnit").value;
    const timeAmount = parseFloat(document.getElementById("timeAmount").value) || 1;
    const points = parseFloat(document.getElementById("points").value) || 0;
    const target = parseFloat(document.getElementById("targetScore").value);

    let unitSeconds = timeAmount;
    if (unit === "minutes") unitSeconds *= 60;
    else if (unit === "hours") unitSeconds *= 3600;
    else if (unit === "days") unitSeconds *= 86400;

    const unitsPassed = Math.floor(elapsedMs / 1000 / unitSeconds);
    score = unitsPassed * points;
    document.getElementById("score").textContent = formatScore(score);

    document.getElementById("timePassed").textContent = formatTime(elapsedMs);
    document.getElementById("status").textContent = "กำลังนับคะแนน...";

    if (!isNaN(target) && target > 0 && points > 0) {
      const totalUnitsNeeded = Math.ceil(target / points);
      const totalElapsedMs = totalUnitsNeeded * unitSeconds * 1000;
      const remainingMs = totalElapsedMs - elapsedMs;

      document.getElementById("elapsed").textContent = formatTime(totalElapsedMs);
      document.getElementById("timeRemaining").textContent = formatTime(remainingMs);

      if (score >= target) {
        clearInterval(interval);
        isRunning = false;
        document.getElementById("status").textContent = "ถึงเป้าหมายแล้ว!";
        document.getElementById("timeRemaining").textContent = "0 วัน 0 ชม. 0 นาที 0 วิ";
      }
    } else {
      document.getElementById("elapsed").textContent = "-";
      document.getElementById("timeRemaining").textContent = "-";
    }
  }

  function start() {
    if (isRunning) return;

    ratePerSecond = calculateRate();
    if (ratePerSecond <= 0) {
      alert("กรุณาใส่คะแนนและหน่วยเวลาที่ถูกต้อง");
      return;
    }

    const points = parseFloat(document.getElementById("points").value) || 0;
    const timeAmount = parseFloat(document.getElementById("timeAmount").value) || 1;
    const unit = document.getElementById("timeUnit").value;
    const target = parseFloat(document.getElementById("targetScore").value);

    let unitSeconds = timeAmount;
    if (unit === "minutes") unitSeconds *= 60;
    else if (unit === "hours") unitSeconds *= 3600;
    else if (unit === "days") unitSeconds *= 86400;

    score = 0;
    document.getElementById("score").textContent = "0";
    document.getElementById("status").textContent = "กำลังนับคะแนน...";
    document.getElementById("timePassed").textContent = formatTime(0);

    if (!isNaN(target) && target > 0 && points > 0) {
      const totalUnitsNeeded = Math.ceil(target / points);
      const totalElapsedMs = totalUnitsNeeded * unitSeconds * 1000;

      document.getElementById("elapsed").textContent = formatTime(totalElapsedMs);
      document.getElementById("timeRemaining").textContent = formatTime(totalElapsedMs);
    } else {
      document.getElementById("elapsed").textContent = "-";
      document.getElementById("timeRemaining").textContent = "-";
    }

    if (!startTime) {
      startTime = new Date();
    }

    if (pauseStart) {
      pausedTime += new Date() - pauseStart;
      pauseStart = null;
    }

    isRunning = true;
    if (interval) clearInterval(interval);
    interval = setInterval(update, 1000);
    update();
  }

  function pause() {
    if (!isRunning) return;
    clearInterval(interval);
    pauseStart = new Date();
    isRunning = false;
    document.getElementById("status").textContent = "หยุดชั่วคราว";
  }

  function reset() {
    clearInterval(interval);
    score = 0;
    startTime = null;
    pausedTime = 0;
    pauseStart = null;
    isRunning = false;
    document.getElementById("score").textContent = "0";
    document.getElementById("elapsed").textContent = "-";
    document.getElementById("timePassed").textContent = "-";
    document.getElementById("timeRemaining").textContent = "-";
    document.getElementById("status").textContent = "รอเริ่ม...";
  }
</script>

</body>
</html>
