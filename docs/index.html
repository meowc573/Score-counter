<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ตัวนับคะแนน</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      max-width: 600px;
      margin: auto;
      background: #f0f2f5;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    section {
      background: white;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-bottom: 30px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    button.action {
      background: #4a90e2;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 16px;
      transition: background 0.3s;
    }
    button.action:hover {
      background: #f5a623;
    }
    .output {
      background: #fafafa;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
      border: 1px solid #eee;
      font-size: 16px;
      line-height: 1.4;
    }
    .flex-row {
      display: flex;
      gap: 10px;
    }
    .flex-row > * {
      flex: 1;
    }
  </style>
</head>
<body>

<h1>ตัวนับคะแนนและคำนวณเวลา</h1>

<!-- ตัวนับคะแนน -->
<section id="counter-section">
  <h2>ตัวนับคะแนน</h2>

  <label>คะแนน (Points)</label>
  <input type="number" id="points1" value="100" min="0" />

  <label>ทุกๆ (จำนวน) หน่วยเวลา</label>
  <div class="flex-row">
    <input type="number" id="timeAmount1" value="10" min="1" />
    <select id="timeUnit1">
      <option value="seconds">วินาที</option>
      <option value="minutes" selected>นาที</option>
      <option value="hours">ชั่วโมง</option>
      <option value="days">วัน</option>
    </select>
  </div>

  <label>คะแนนเป้าหมาย (ถ้ามี)</label>
  <input type="number" id="targetScore1" placeholder="ใส่คะแนนเป้าหมาย (ถ้ามี)" />

  <div class="flex-row">
    <button class="action" onclick="startCounter()">เริ่ม</button>
    <button class="action" onclick="pauseCounter()">พัก</button>
    <button class="action" onclick="resetCounter()">รีเซต</button>
  </div>

  <div class="output">
    <p>สถานะ: <span id="status1">รอเริ่ม...</span></p>
    <p>คะแนน: <span id="score1">0.00</span></p>
    <p>เวลาที่ใช้ทั้งหมด (วินาที): <span id="elapsed1">-</span></p>
    <p>เวลาที่ผ่านไป: <span id="timePassed1">-</span></p>
    <p>เวลาที่เหลือ: <span id="timeRemaining1">-</span></p>
  </div>
</section>

<!-- คำนวณเวลา -->
<section id="calculator-section">
  <h2>คำนวณเวลาเพื่อถึงคะแนนเป้าหมาย</h2>

  <label>คะแนน (Points ที่ได้ในช่วงเวลา)</label>
  <input type="number" id="points2" value="100" min="0" />

  <label>ใช้เวลา (หน่วยเวลา)</label>
  <div class="flex-row">
    <input type="number" id="timeAmount2" value="10" min="1" />
    <select id="timeUnit2">
      <option value="seconds">วินาที</option>
      <option value="minutes" selected>นาที</option>
      <option value="hours">ชั่วโมง</option>
      <option value="days">วัน</option>
    </select>
  </div>

  <label>คะแนนเป้าหมาย</label>
  <input type="number" id="targetScore2" value="1000" min="0" />

  <button class="action" onclick="calculateTime()">คำนวณเวลา</button>

  <div class="output">
    <p>อัตรา: <span id="rate2">-</span> คะแนนต่อวินาที</p>
    <p>เวลาที่ต้องใช้: <span id="requiredTime2">-</span></p>
  </div>
</section>

<script>
function formatTime(ms) {
  if (ms < 0) ms = 0;
  const sec = Math.floor(ms / 1000);
  const days = Math.floor(sec / 86400);
  const hours = Math.floor((sec % 86400) / 3600);
  const minutes = Math.floor((sec % 3600) / 60);
  const seconds = sec % 60;
  return `${days} วัน ${hours} ชม. ${minutes} นาที ${seconds} วิ`;
}

// ตัวนับคะแนน
function calculateRate1() {
  const points = parseFloat(document.getElementById("points1").value) || 0;
  const timeAmount = parseFloat(document.getElementById("timeAmount1").value) || 1;
  const unit = document.getElementById("timeUnit1").value;

  let seconds = timeAmount;
  if (unit === "minutes") seconds *= 60;
  else if (unit === "hours") seconds *= 3600;
  else if (unit === "days") seconds *= 86400;

  return points / seconds;
}

let score1 = 0;
let startTime1 = null;
let pausedTime1 = 0;
let pauseStart1 = null;
let interval1 = null;
let ratePerSecond1 = 0;
let isRunning1 = false;

function saveCounterState() {
  localStorage.setItem("counterState", JSON.stringify({
    startTime: startTime1 ? startTime1.getTime() : null,
    pausedTime: pausedTime1,
    pauseStart: pauseStart1 ? pauseStart1.getTime() : null,
    score: score1,
    ratePerSecond: ratePerSecond1,
    isRunning: isRunning1,
    points: document.getElementById("points1").value,
    timeAmount: document.getElementById("timeAmount1").value,
    timeUnit: document.getElementById("timeUnit1").value,
    targetScore: document.getElementById("targetScore1").value || null,
  }));
}

function loadCounterState() {
  const data = localStorage.getItem("counterState");
  if (!data) return null;
  try {
    return JSON.parse(data);
  } catch {
    return null;
  }
}

function clearCounterState() {
  localStorage.removeItem("counterState");
}

function updateCounter() {
  if (!isRunning1) return;

  const now = new Date();
  const elapsed = (now - startTime1 - pausedTime1) / 1000;
  score1 = elapsed * ratePerSecond1;

  const elapsedCalc = score1 / ratePerSecond1;

  document.getElementById("score1").textContent = score1.toFixed(2);
  document.getElementById("elapsed1").textContent = Math.floor(elapsedCalc);

  const target = parseFloat(document.getElementById("targetScore1").value);
  if (!isNaN(target) && ratePerSecond1 > 0) {
    const remainingMs = ((target - score1) / ratePerSecond1) * 1000;
    document.getElementById("timeRemaining1").textContent = formatTime(remainingMs);
    document.getElementById("timePassed1").textContent = formatTime(elapsed * 1000);

    if (score1 >= target) {
      clearInterval(interval1);
      interval1 = null;
      isRunning1 = false;
      document.getElementById("status1").textContent = "ถึงเป้าหมายแล้ว!";
      document.getElementById("timeRemaining1").textContent = "0 วินาที";
      clearCounterState();
      return;
    }
  } else {
    document.getElementById("timeRemaining1").textContent = "-";
    document.getElementById("timePassed1").textContent = formatTime(elapsed * 1000);
  }

  document.getElementById("status1").textContent = "กำลังนับคะแนน...";
  saveCounterState();
}

function startCounter() {
  if (isRunning1) return;

  ratePerSecond1 = calculateRate1();
  if (ratePerSecond1 <= 0) {
    alert("กรุณาใส่คะแนนและหน่วยเวลาที่ถูกต้อง");
    return;
  }

  if (!startTime1) {
    startTime1 = new Date();
  }

  if (pauseStart1) {
    pausedTime1 += new Date() - pauseStart1;
    pauseStart1 = null;
  }

  isRunning1 = true;

  if (interval1) clearInterval(interval1);
  interval1 = setInterval(updateCounter, 1000);
  updateCounter();
}

function pauseCounter() {
  if (!isRunning1) return;

  clearInterval(interval1);
  interval1 = null;
  pauseStart1 = new Date();
  isRunning1 = false;
  document.getElementById("status1").textContent = "หยุดชั่วคราว";
  saveCounterState();
}

function resetCounter() {
  clearInterval(interval1);
  interval1 = null;
  score1 = 0;
  startTime1 = null;
  pausedTime1 = 0;
  pauseStart1 = null;
  isRunning1 = false;

  document.getElementById("score1").textContent = "0.00";
  document.getElementById("elapsed1").textContent = "-";
  document.getElementById("timePassed1").textContent = "-";
  document.getElementById("timeRemaining1").textContent = "-";
  document.getElementById("status1").textContent = "รอเริ่ม...";
  clearCounterState();
}

function restoreCounter() {
  const state = loadCounterState();
  if (!state) return;

  // คืนค่าตัว input
  if(state.points !== undefined) document.getElementById("points1").value = state.points;
  if(state.timeAmount !== undefined) document.getElementById("timeAmount1").value = state.timeAmount;
  if(state.timeUnit !== undefined) document.getElementById("timeUnit1").value = state.timeUnit;
  if(state.targetScore !== null) document.getElementById("targetScore1").value = state.targetScore;

  score1 = state.score || 0;
  ratePerSecond1 = state.ratePerSecond || 0;
  pausedTime1 = state.pausedTime || 0;
  pauseStart1 = state.pauseStart ? new Date(state.pauseStart) : null;
  isRunning1 = state.isRunning || false;
  startTime1 = state.startTime ? new Date(state.startTime) : null;

  document.getElementById("score1").textContent = score1.toFixed(2);

  if (isRunning1) {
    startCounter();
  } else {
    if (pauseStart1) {
      document.getElementById("status1").textContent = "หยุดชั่วคราว";
      updateCounter();
    } else {
      document.getElementById("status1").textContent = "รอเริ่ม...";
    }
  }
}

// คำนวณเวลา
function calculateRate2() {
  const points = parseFloat(document.getElementById("points2").value) || 0;
  const timeAmount = parseFloat(document.getElementById("timeAmount2").value) || 1;
  const unit = document.getElementById("timeUnit2").value;

  let seconds = timeAmount;
  if (unit === "minutes") seconds *= 60;
  else if (unit === "hours") seconds *= 3600;
  else if (unit === "days") seconds *= 86400;

  return points / seconds;
}

function calculateTime() {
  const target = parseFloat(document.getElementById("targetScore2").value);
  if (isNaN(target) || target <= 0) {
    alert("กรุณาใส่คะแนนเป้าหมายที่ถูกต้อง");
    return;
  }

  const rate = calculateRate2();
  if (rate <= 0) {
    alert("กรุณาใส่คะแนนและหน่วยเวลาที่ถูกต้อง");
    return;
  }

  const timeNeededSeconds = target / rate;

  let displayTime = "";
  if (timeNeededSeconds >= 86400) {
    const days = Math.floor(timeNeededSeconds / 86400);
    const remainder = timeNeededSeconds % 86400;
    const hrs = Math.floor(remainder / 3600);
    const mins = Math.floor((remainder % 3600) / 60);
    displayTime = `${days} วัน ${hrs} ชม. ${mins} นาที`;
  } else if (timeNeededSeconds >= 3600) {
    const hrs = Math.floor(timeNeededSeconds / 3600);
    const mins = Math.floor((timeNeededSeconds % 3600) / 60);
    displayTime = `${hrs} ชม. ${mins} นาที`;
  } else if (timeNeededSeconds >= 60) {
    const mins = Math.floor(timeNeededSeconds / 60);
    const secs = Math.floor(timeNeededSeconds % 60);
    displayTime = `${mins} นาที ${secs} วินาที`;
  } else {
    displayTime = `${Math.floor(timeNeededSeconds)} วินาที`;
  }

  document.getElementById("rate2").textContent = rate.toFixed(4);
  document.getElementById("requiredTime2").textContent = displayTime;
}

// โหลดสถานะเมื่อเปิดหน้าใหม่
window.addEventListener("load", () => {
  restoreCounter();
});
</script>

</body>
</html>
